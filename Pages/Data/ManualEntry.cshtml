@page
@model SmartLab.Pages.Data.ManualEntryModel
@{
    ViewData["Title"] = "Manual Data Entry";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Upload Dataset Manually</h1>
    <div>
        <a href="/Data/DataIndex" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Datasets
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="post" enctype="multipart/form-data">
            <div class="mb-3">
                <label class="form-label">Dataset Name:</label>
                <input class="form-control" asp-for="DatasetName" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Dataset Date:</label>
                <input class="form-control" type="date" id="dataset_date" asp-for="DatasetDate" required />
                <span asp-validation-for="DatasetDate" class="text-danger"></span>
                <div class="form-text">Select the date when this dataset was created.</div>
            </div>
            <div class="mb-3">
                <label class="form-label">Dataset Time:</label>
                <input class="form-control" type="time" id="dataset_time" asp-for="DatasetTime" required />
                <span asp-validation-for="DatasetTime" class="text-danger"></span>
                <div class="form-text">Select the time (HH:mm) when this dataset was created.</div>
            </div>
            <div class="mb-3">
                <label class="form-label">Dataset Description 
                <textarea class="form-control" asp-for="DatasetDescription" rows="3" placeholder="Enter a description for your dataset (optional)"></textarea>
                <span asp-validation-for="DatasetDescription" class="text-danger"></span>
                <div class="form-text">You can leave this field empty if you don't want to add a description.</div>
            </div>
            <div class="mb-3">
                <label class="form-label">Dataset File:</label>
                <input class="form-control" type="file" name="file" required/>
            </div>
            <div class="mt-4">
                <button class="btn btn-success" type="submit">
                    <i class="fas fa-upload"></i> Upload
                </button>
            </div>
        </form>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dateInput = document.getElementById("dataset_date");
        const timeInput = document.getElementById("dataset_time");

        // Set current date and time as defaults
        const now = new Date();

        // Format date as YYYY-MM-DD
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        dateInput.value = `${year}-${month}-${day}`;

        // Format time as HH:MM
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        timeInput.value = `${hours}:${minutes}`;

        // No client-side date/time validation - user can select any date and time

        // Debug: Check description field validation
        const descriptionTextarea = document.querySelector('textarea[name="DatasetDescription"]');
        if (descriptionTextarea) {
            // Ensure it's explicitly not required
            descriptionTextarea.removeAttribute('required');
            descriptionTextarea.setAttribute('aria-required', 'false');

            // Add event listener to debug validation
            descriptionTextarea.addEventListener('invalid', function(e) {
                console.log('Description field validation error:', e.target.validationMessage);
                // Prevent default validation since this field should be optional
                e.preventDefault();
                e.target.setCustomValidity('');
            });
        }
    });
</script>